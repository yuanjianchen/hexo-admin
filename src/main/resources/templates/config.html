<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>配置</title>
    <link th:include="component/head::head">
</head>
<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="ibox float-e-margins">
        <div class="ibox-title">
            <h5 th:text="${blogConfig.name}">已有博客 <small></small></h5>
            <div class="ibox-tools">
                <a class="collapse-link">
                    <i class="fa fa-chevron-up"></i>
                </a>
            </div>
        </div>
        <div class="ibox-content">
            <!--/*@thymesVar id="blogConfig" type="tech.stack.hexo.domain.BlogConfig"*/-->
            <form class="form-horizontal" th:object="${blogConfig}" id="blogConfig">
                <input type="hidden" th:field="*{id}">
                <div class="form-group">
                    <label class="col-sm-1 control-label">路径配置：</label>
                    <div class="col-sm-11">
                        <input th:field="*{filePath}" type="text"
                               placeholder="请填写已有博客路径" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-1 control-label">远程仓库：</label>
                    <div class="col-sm-11">
                        <input th:field="*{remoteUrl}" type="text" placeholder="请填写远程仓库地址"
                               class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-1 control-label">博文路径：</label>
                    <div class="col-sm-11">
                        <input th:field="*{sourcePath}" type="text" placeholder="博文路径,不填将使用默认路径"
                               class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-1 control-label">博文仓库：</label>
                    <div class="col-sm-11">
                        <input th:field="*{sourceRemoteUrl}" type="text" placeholder="博文路径,不填将使用默认路径"
                               class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-12">
                        <button class="btn btn-sm btn-info" type="button" onclick="enableForm('blogConfig')">编辑</button>
                        <button class="btn btn-sm btn-danger" type="button" id="save">保存</button>
                        <button class="btn btn-sm btn-primary" type="button" id="initBlog"
                                th:text="*{initialized}?'更新':'初始化'">初始化
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<div th:include="component/head::script"/>
<!-- 自定义js -->
<script src="js/content.js?v=1.0.0"></script>
<script type="text/javascript">


    $(document).ready(function () {
        disableForm('blogConfig')
        $("#save").click(function () {
            let $filePath = $("#filePath");
            if ($filePath.attr("disabled")) {
                return
            }
            let blogPath = $filePath.val()
            if (!blogPath) {
                layer.msg("请填写博客路径")
                return
            }
            $.ajax({
                url: '/config/save',
                type: 'POST',
                data: formJson('blogConfig'),
                dataType: 'json',
                contentType: 'application/json',
                success: function (res) {
                    layer.msg(res.message)
                    if (res.success) {
                        window.location.reload()
                    }
                }
            })
        })
        $("#initBlog").click(function () {
            let id = $("#id").val()
            let data = "id=" + id
            $.post("/config/init", data, function (res) {
                if (res.success) {
                    window.parent.loadMenu()
                    window.location.reload()
                }
            })
        })
    })


</script>
</body>
</html>